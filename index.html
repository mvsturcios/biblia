<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Biblia Reina Valera 1960</title>
    <!-- Color de la barra de estado en Android -->
    <meta name="theme-color" content="#ffffff">
    
    <style>
        /* --- VARIABLES GLOBALES --- */
        :root {
            /* Colores Base (Modo Claro) */
            --primary: #ff6b00;
            --primary-bg: rgba(255, 107, 0, 0.12);
            
            --bg-body: #ffffff;
            --bg-card: #f8f9fa;
            --bg-overlay: rgba(255, 255, 255, 0.95);
            --bg-input: #f0f2f5;
            
            --text-main: #121212;
            --text-body: #2c2c2c;
            --text-muted: #666666;
            
            --border: #e0e0e0;
            --shadow-float: 0 4px 20px rgba(0,0,0,0.1);
            
            /* Tipografía */
            --font-ui: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            --font-read: 'Georgia', 'Times New Roman', serif;
        }

        /* --- MODO OSCURO (Profundo y Real) --- */
        body.dark {
            --primary: #ff8533; 
            --primary-bg: rgba(255, 133, 51, 0.2);

            --bg-body: #161616; /* Negro suave solicitado */
            --bg-card: #1e1e1e;
            --bg-overlay: rgba(22, 22, 22, 0.95);
            --bg-input: #2a2a2a;
            
            --text-main: #ffffff;
            --text-body: #e0e0e0;
            --text-muted: #a0a0a0;
            
            --border: #333333;
            --shadow-float: 0 4px 25px rgba(0,0,0,0.5);
        }

        /* --- RESET Y BASE --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html {
            /* Scroll suave nativo */
            scroll-behavior: smooth;
        }

        body {
            margin: 0; 
            padding: 0;
            font-family: var(--font-ui);
            background-color: var(--bg-body);
            color: var(--text-main);
            /* Transiciones de tema suaves */
            transition: background-color 0.3s ease, color 0.3s ease;
            /* Importante para scroll: min-height */
            min-height: 100vh;
            /* Aseguramos que el texto sea legible */
            line-height: 1.5;
            padding-top: 70px; /* Espacio para el Header Fijo */
            padding-bottom: 120px; /* Espacio para la Barra Inferior */
        }

        /* --- ICONOS SVG --- */
        /* Esta regla es CRÍTICA para arreglar el problema de color */
        svg {
            width: 24px;
            height: 24px;
            display: block;
            fill: currentColor; /* Toma el color del texto del botón padre */
            pointer-events: none;
        }

        /* --- HEADER FIJO --- */
        .header {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 60px;
            background: var(--bg-overlay);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            z-index: 100; /* Encima de todo */
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 8px;
            transition: background 0.3s, border-color 0.3s;
        }

        .header-title {
            text-align: center;
            flex: 1;
            overflow: hidden;
            white-space: nowrap;
        }
        .title-main { font-weight: 800; font-size: 1.1rem; display: block; }
        .title-sub { font-size: 0.75rem; color: var(--text-muted); font-weight: 500; }

        /* --- BOTONES --- */
        button {
            background: transparent;
            border: none;
            cursor: pointer;
            color: var(--text-main); /* Hereda color del tema */
            font-family: inherit;
        }

        .btn-icon {
            width: 44px; height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }
        .btn-icon:active { background-color: var(--bg-input); }

        /* --- CONTENIDO BÍBLICO (Scroll Nativo) --- */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 20px;
        }

        #verse-display {
            font-family: var(--font-read);
            font-size: 18px; /* Tamaño base */
            color: var(--text-body);
            line-height: 1.8;
        }

        .verse {
            margin-bottom: 15px;
            /* Mejora la legibilidad */
            text-align: left; 
        }

        .verse-num {
            font-family: var(--font-ui);
            font-size: 0.7em;
            font-weight: 700;
            color: var(--primary);
            margin-right: 6px;
            vertical-align: 3px;
            user-select: none;
        }

        /* --- BARRA INFERIOR FLOTANTE --- */
        .bottom-bar-container {
            position: fixed;
            bottom: 25px;
            left: 0; right: 0;
            display: flex;
            justify-content: center;
            z-index: 90;
            pointer-events: none; /* Permite tocar a los lados */
        }

        .bottom-nav {
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 6px 10px;
            border-radius: 50px;
            box-shadow: var(--shadow-float);
            display: flex;
            align-items: center;
            gap: 5px;
            pointer-events: auto; /* Reactiva clicks */
        }

        .btn-nav-text {
            background: var(--primary);
            color: #ffffff !important; /* Forzamos blanco siempre */
            font-weight: 700;
            padding: 10px 24px;
            border-radius: 25px;
            font-size: 0.95rem;
            box-shadow: 0 2px 10px rgba(255, 107, 0, 0.3);
        }
        .btn-nav-text:active { transform: scale(0.96); }

        /* --- MENÚ LATERAL (DRAWER) --- */
        .overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 105;
            opacity: 0; pointer-events: none;
            transition: opacity 0.3s;
            backdrop-filter: blur(3px);
        }
        .overlay.active { opacity: 1; pointer-events: auto; }

        .drawer {
            position: fixed; top: 0; bottom: 0; left: 0;
            width: 85%; max-width: 340px;
            background: var(--bg-body);
            z-index: 110;
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column;
            box-shadow: 5px 0 25px rgba(0,0,0,0.3);
        }
        .drawer.active { transform: translateX(0); }

        .drawer-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 800; font-size: 1.2rem;
        }

        .drawer-content {
            flex: 1;
            overflow-y: auto; /* Scroll interno del menú */
            padding: 10px;
        }

        .list-item {
            padding: 14px 16px;
            border-radius: 12px;
            margin-bottom: 4px;
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 500;
            color: var(--text-body);
            transition: background 0.2s;
        }
        .list-item:active { background-color: var(--bg-input); }
        .list-item.active {
            background-color: var(--primary-bg);
            color: var(--primary);
            font-weight: 700;
        }
        .list-item small { opacity: 0.6; font-weight: 400; }

        /* --- MODAL INFERIOR (SHEET) --- */
        .sheet {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: var(--bg-body);
            z-index: 110;
            border-radius: 24px 24px 0 0;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 -5px 30px rgba(0,0,0,0.3);
            max-height: 85vh;
            display: flex; flex-direction: column;
            border-top: 1px solid var(--border);
        }
        .sheet.active { transform: translateY(0); }

        .input-modern {
            width: 100%;
            background: var(--bg-input);
            border: none;
            padding: 14px;
            border-radius: 14px;
            font-size: 16px;
            color: var(--text-main);
            outline: none;
            font-family: inherit;
        }
        .input-modern::placeholder { color: var(--text-muted); }

        /* Range Slider Custom */
        input[type=range] {
            width: 100%;
            height: 6px;
            background: var(--bg-input);
            border-radius: 5px;
            outline: none;
            -webkit-appearance: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px; height: 24px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        /* Utilidades */
        .text-center { text-align: center; }
        .mt-2 { margin-top: 20px; }
        .mb-2 { margin-bottom: 20px; }
    </style>
</head>
<body>

    <!-- Overlay Negro (Fondo al abrir menús) -->
    <div id="overlay" class="overlay"></div>

    <!-- HEADER SUPERIOR (FIJO) -->
    <header class="header">
        <button id="btn-menu" class="btn-icon">
            <svg viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
        </button>

        <div class="header-title" id="header-text-container">
            <span id="title-book" class="title-main">Cargando...</span>
            <span id="title-cap" class="title-sub">...</span>
        </div>

        <div style="display: flex; gap: 4px;">
            <button id="btn-search" class="btn-icon">
                <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            </button>
            <button id="btn-settings" class="btn-icon">
                <svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L3.16 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.04.64.09.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.04.24.24.41.48.41h3.84c.24 0 .43-.17.47-.41l.36-2.54c.59-.24 1.13-.57 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.08-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
            </button>
        </div>
    </header>

    <!-- CONTENIDO PRINCIPAL (Donde ocurre el scroll) -->
    <main class="container">
        <div id="verse-display">
            <!-- Texto inyectado aquí -->
        </div>
        <!-- Espacio final para asegurar que se lee lo ultimo -->
        <div style="height: 50px;"></div>
    </main>

    <!-- BARRA INFERIOR (FLOTANTE) -->
    <div class="bottom-bar-container">
        <nav class="bottom-nav">
            <button id="btn-prev" class="btn-icon">
                <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
            </button>
            
            <button id="btn-chapters" class="btn-nav-text">Capítulos</button>
            
            <button id="btn-next" class="btn-icon">
                <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
            </button>
        </nav>
    </div>

    <!-- MENÚ LATERAL: LIBROS -->
    <aside id="drawer-books" class="drawer">
        <div class="drawer-header">
            <span>Libros</span>
            <button class="btn-icon close-modal"><svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button>
        </div>
        <div style="padding: 15px;">
            <input type="text" id="filter-books" class="input-modern" placeholder="Buscar libro (Ej. Juan)...">
        </div>
        <div id="list-books" class="drawer-content">
            <!-- Lista JS -->
        </div>
    </aside>

    <!-- PANEL INFERIOR: BÚSQUEDA -->
    <div id="sheet-search" class="sheet" style="height: 80vh;">
        <div class="drawer-header">
            <span>Búsqueda</span>
            <button class="btn-icon close-modal"><svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button>
        </div>
        <div style="padding: 15px;">
            <input type="text" id="input-search" class="input-modern" placeholder="Escribe para buscar...">
        </div>
        <div id="results-container" class="drawer-content">
            <div class="text-center" style="color:var(--text-muted); padding-top:20px;">
                Resultados aquí...
            </div>
        </div>
    </div>

    <!-- PANEL INFERIOR: AJUSTES -->
    <div id="sheet-settings" class="sheet" style="height: auto;">
        <div class="drawer-header">
            <span>Ajustes</span>
            <button class="btn-icon close-modal"><svg viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg></button>
        </div>
        <div style="padding: 25px;">
            <p style="font-weight:bold; margin-bottom:10px;">Tamaño de Texto</p>
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 30px;">
                <span style="font-size:14px">A</span>
                <input type="range" id="range-font" min="16" max="32" value="18">
                <span style="font-size:24px">A</span>
            </div>

            <p style="font-weight:bold; margin-bottom:10px;">Tema</p>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div onclick="App.setTheme('light')" style="background:#eee; padding:15px; border-radius:12px; text-align:center; color:#333; cursor:pointer;">
                    Claro
                </div>
                <div onclick="App.setTheme('dark')" style="background:#161616; padding:15px; border-radius:12px; text-align:center; color:#fff; border:1px solid #333; cursor:pointer;">
                    Oscuro
                </div>
            </div>
            
            <p class="text-center" style="font-size: 12px; color: var(--text-muted); margin-top: 30px;">
                NeoPunto Bible v2.5 Stable
            </p>
        </div>
    </div>

    <!-- CARGA DE DATOS -->
    <script src="bible_data.js"></script>

    <!-- LÓGICA DE APLICACIÓN -->
    <script>
        const App = {
            state: {
                book: 0,
                chapter: 0,
                fontSize: 18,
                theme: 'light'
            },
            
            els: {},

            init() {
                // Cache Elements
                this.els = {
                    display: document.getElementById('verse-display'),
                    titleBook: document.getElementById('title-book'),
                    titleCap: document.getElementById('title-cap'),
                    bookList: document.getElementById('list-books'),
                    overlay: document.getElementById('overlay'),
                    metaTheme: document.querySelector('meta[name="theme-color"]'),
                    modals: {
                        books: document.getElementById('drawer-books'),
                        search: document.getElementById('sheet-search'),
                        settings: document.getElementById('sheet-settings')
                    }
                };

                // Check Data integrity
                if(typeof bibleData === 'undefined') {
                    this.els.display.innerHTML = `<h3 style="color:red; text-align:center; margin-top:50px;">Error: Falta bible_data.js</h3>`;
                    return;
                }

                this.loadSettings();
                this.renderBooks();
                this.loadChapter(this.state.book, this.state.chapter);
                this.bindEvents();
            },

            bindEvents() {
                // Open Modals
                document.getElementById('btn-menu').onclick = () => this.openModal('books');
                document.getElementById('btn-chapters').onclick = () => this.openModal('books'); // Reusa el menú de libros
                document.getElementById('btn-search').onclick = () => this.openModal('search');
                document.getElementById('btn-settings').onclick = () => this.openModal('settings');

                // Close Modals
                this.els.overlay.onclick = () => this.closeAll();
                document.querySelectorAll('.close-modal').forEach(btn => btn.onclick = () => this.closeAll());

                // Navigation
                document.getElementById('btn-prev').onclick = () => this.nav(-1);
                document.getElementById('btn-next').onclick = () => this.nav(1);

                // Interactions
                document.getElementById('range-font').oninput = (e) => this.setFont(e.target.value);
                
                // Book Filter
                document.getElementById('filter-books').oninput = (e) => {
                    const q = e.target.value.toLowerCase();
                    Array.from(this.els.bookList.children).forEach(el => {
                        el.style.display = el.textContent.toLowerCase().includes(q) ? 'flex' : 'none';
                    });
                };

                // Search Debounce
                let timer;
                document.getElementById('input-search').oninput = (e) => {
                    clearTimeout(timer);
                    timer = setTimeout(() => this.runSearch(e.target.value), 500);
                };
            },

            loadChapter(b, c) {
                // Save Logic
                this.state.book = b;
                this.state.chapter = c;
                this.saveSettings();

                const book = bibleData[b];
                const verses = book.chapters[c];

                // Update Header
                this.els.titleBook.textContent = book.name;
                this.els.titleCap.textContent = `Capítulo ${c+1}`;

                // Update Content
                // Usamos map y join para inyección rápida
                const html = verses.map((v, i) => 
                    `<div class="verse"><span class="verse-num">${i+1}</span>${v}</div>`
                ).join('');
                
                this.els.display.innerHTML = html;
                
                // IMPORTANTE: Reset Scroll de la ventana al cambiar capítulo
                window.scrollTo(0,0);
                
                this.updateActiveBook();
            },

            nav(dir) {
                let b = this.state.book;
                let c = this.state.chapter + dir;
                
                if (c < 0) {
                    if (b > 0) { b--; c = bibleData[b].chapters.length - 1; }
                    else return;
                } else if (c >= bibleData[b].chapters.length) {
                    if (b < bibleData.length - 1) { b++; c = 0; }
                    else return;
                }
                this.loadChapter(b, c);
            },

            renderBooks() {
                this.els.bookList.innerHTML = bibleData.map((book, i) => `
                    <div class="list-item" onclick="App.selectBook(${i})">
                        <span>${book.name}</span>
                        <small>${book.chapters.length}</small>
                    </div>
                `).join('');
            },

            selectBook(i) {
                this.loadChapter(i, 0);
                this.closeAll();
            },

            updateActiveBook() {
                const items = this.els.bookList.children;
                for(let i=0; i<items.length; i++) {
                    if(i === this.state.book) items[i].classList.add('active');
                    else items[i].classList.remove('active');
                }
            },

            // --- UI ---
            openModal(name) {
                this.closeAll(); // Close others first
                this.els.overlay.classList.add('active');
                this.els.modals[name].classList.add('active');
            },

            closeAll() {
                this.els.overlay.classList.remove('active');
                Object.values(this.els.modals).forEach(m => m.classList.remove('active'));
            },

            // --- Settings ---
            setTheme(mode) {
                this.state.theme = mode;
                if(mode === 'dark') {
                    document.body.classList.add('dark');
                    this.els.metaTheme.content = "#161616";
                } else {
                    document.body.classList.remove('dark');
                    this.els.metaTheme.content = "#ffffff";
                }
                this.saveSettings();
            },

            setFont(size) {
                this.state.fontSize = size;
                this.els.display.style.fontSize = size + 'px';
                this.saveSettings();
            },

            saveSettings() {
                localStorage.setItem('neo_bible_v3', JSON.stringify(this.state));
            },

            loadSettings() {
                const saved = JSON.parse(localStorage.getItem('neo_bible_v3'));
                if(saved) {
                    this.state = {...this.state, ...saved};
                } else if(window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    this.state.theme = 'dark';
                }
                
                // Apply
                this.setTheme(this.state.theme);
                this.setFont(this.state.fontSize);
                document.getElementById('range-font').value = this.state.fontSize;
            },

            // --- Search ---
            runSearch(q) {
                const con = document.getElementById('results-container');
                if(q.length < 3) {
                    con.innerHTML = '<div class="text-center" style="color:var(--text-muted); margin-top:20px;">Escribe 3 letras...</div>';
                    return;
                }

                con.innerHTML = '<div class="text-center" style="margin-top:20px;">Buscando...</div>';

                setTimeout(() => {
                    const results = [];
                    const limit = 50;
                    const qLow = q.toLowerCase();

                    bibleData.some((book, bIdx) => {
                        return book.chapters.some((chap, cIdx) => {
                            return chap.some((txt, vIdx) => {
                                if(txt.toLowerCase().includes(qLow)) {
                                    results.push({
                                        ref: `${book.name} ${cIdx+1}:${vIdx+1}`,
                                        txt, b: bIdx, c: cIdx
                                    });
                                }
                                return results.length >= limit;
                            });
                        });
                    });

                    if(results.length === 0) {
                        con.innerHTML = '<div class="text-center" style="color:var(--text-muted); margin-top:20px;">Sin resultados</div>';
                    } else {
                        con.innerHTML = results.map(r => `
                            <div class="list-item" style="display:block;" onclick="App.jumpTo(${r.b}, ${r.c})">
                                <div style="color:var(--primary); font-weight:bold; font-size:14px;">${r.ref}</div>
                                <div style="font-size:14px; margin-top:4px;">${r.txt}</div>
                            </div>
                        `).join('');
                    }
                }, 100);
            },

            jumpTo(b, c) {
                this.loadChapter(b, c);
                this.closeAll();
            }
        };

        // Start
        document.addEventListener('DOMContentLoaded', () => App.init());
    </script>
</body>
</html>

